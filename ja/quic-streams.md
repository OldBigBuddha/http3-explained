# ストリーム

QUIC におけるストリームは軽量で順序付けられたバイトストリームの概念を提供します。

QUICには基本的に2種類のストリームが存在します:

 - イニシエータからピアへデータを1方向に伝送する単方向ストリーム

 - お互いにデータを送ることができる双方向ストリーム

どちらのストリームにおいても、どちらのエンドポイントからでも作成でき、
また他のストリームとインターリーブされたデータを送ったり、中止したりすることが出来ます。

QUIC の接続を経由してデータを送る時には、1つ以上のストリームが利用されます。

## フロー制御

ストリームは各自独立にフロー制御が行われ、エンドポイントがメモリの割当量を制限したり、バックプレッシャー
をかけたりできるようになっています。
ストリーム作成も同様にフロー制御が行われ、作成したピアが個別に最大の Stream ID を一時的に要求します。

## ストリームの識別名

ストリームは unsigned な 62bit の整数により識別され、この整数を Stream ID と呼びます。
Stream ID の最下位 2bit はストリームの種類(単方向か双方向か)とストリームのイニシエータの識別に
利用されます。

Stream ID の 最下位 bit (0x1) は ストリームのイニシエータを識別します。
クライアントは偶数のストリームを開始し(このときの最下位 bit は 0 となります)、
サーバーは奇数のストリームを開始します(このときの最下位 bit は 1 となります)。

Stream ID の最下位 2bit (0x2) は 単方向ストリームと双方向ストリームの両者を区別します。
単方向ストリームでは常にこの bit は 1 に設定され、双方向ストリームではこの bit は 0 に設定されます。

## ストリームの同時並行

QUIC では任意の数のストリームを同時並行で操作することができます。エンドポイントは　Stream ID の上限を
制限することにより並行動作中の入力ストリームの数を制限します。

Stream ID の上限はエンドポイントそれぞれで独立しており、設定を受け取ったピアにのみ適用されます。


## データの送受信

エンドポイントはデータの送受信にストリームを利用します。それがストリームの究極の目的です。
ストリームは順序付けられたバイトストリームの概念です。
別々のストリームは必ずしも元の順序で配信されるとは限りません。

## ストリームの優先順位付け

ストリームに割り当てられたリソースに正しい優先順位付けがされているのならば、ストリームの多重化は
アプリケーションのパフォーマンスに莫大な効果を与えます。
HTTP/2 のような他の多重化されたプロトコルでの経験から言って、効果的な優先順位付けの計画はパフォーマンス
に莫大なプラスの影響を持ちます。

QUIC 自身は優先順位付けの情報を交換するフレームを持ちません。そのかわり、QUIC を利用するアプリケーションからの優先順位の情報取得に依拠します。
QUIC を利用するプロトコルはそのアプリケーションのセマンティクスに合った優先順位付けのスキームを定義することが出来ます。

HTTP/3 に QUIC を利用する場合、HTTP レイヤにおいては優先順位付けは不要です。